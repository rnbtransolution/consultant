<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ลงหม้อสุกี้ - Food Safety Audit Checklist (สำหรับพิมพ์)</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Noto+Sans+Thai:wght@300;400;600&family=Raleway:wght@100&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Chonburi&display=swap" rel="stylesheet"/>

<style>
  /* Custom utility classes for fonts */
  .font-inter { font-family: 'Inter', 'Noto Sans Thai', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  .font-playfair-display { font-family: 'Playfair Display', serif; }
  .font-outfit { font-family: 'Outfit', sans-serif; }
  .font-chonburi { font-family: 'Chonburi', cursive; }

  /* Ensure the input and textarea styles are consistent */
  .input-field {
    @apply mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm;
  }
  .textarea-field {
    @apply mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm resize-y;
  }
  .label-class {
    @apply block text-sm font-medium text-gray-700;
  }
  .checkbox-label-class {
    @apply flex items-center text-sm text-gray-700;
  }
  .checkbox-input-class {
    @apply h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded;
  }

  /* ------------------- Print Specific Styles (A4) ------------------- */
  @media print {
    body {
      background-color: white !important;
      color: black !important;
      margin: 0;
      padding: 0;
      /* Define A4 size and margins */
      width: 210mm; /* A4 width */
      min-height: 297mm; /* A4 height */
      -webkit-print-color-adjust: exact; /* Ensure colors print exactly as defined */
      print-color-adjust: exact;
    }

    /* Main container: remove shadows, rounded corners, extra padding */
    .max-w-4xl, .bg-white {
      background-color: white !important;
      box-shadow: none !important;
      border: none !important;
      padding: 0 !important;
      margin: 0 !important;
      width: 100% !important; /* Take full width for print */
    }

    /* Remove extra spacing between sections for tighter print layout */
    .space-y-8 > :not([hidden]) ~ :not([hidden]) {
      margin-top: 1.5rem !important; /* Default was 2rem, reducing slightly */
    }

    /* Header */
    .flex.justify-between.items-center.pb-6.border-b {
      border-bottom: 1px solid #ccc !important;
      padding-bottom: 10px !important;
      flex-direction: row !important; /* Ensure header elements stay in row */
      align-items: flex-end !important;
      padding-top: 0 !important; /* Remove top padding if any */
    }
    .font-chonburi, .font-inter {
      color: black !important;
    }
    .font-chonburi {
      font-size: 24pt !important; /* Adjust font size for print */
      line-height: 1.2;
    }
    .font-chonburi span {
      font-size: 10pt !important;
    }
    .text-xs {
      font-size: 8pt !important;
    }

    /* Title band */
    .bg-gradient-to-br {
      background: #e5e7eb !important; /* Light gray for print */
      color: black !important;
      border-left: 4mm solid #f59e0b !important; /* Amber border */
      padding: 15px !important;
      border-radius: 0 !important;
      margin-top: 1.5rem !important;
    }
    .bg-gradient-to-br h1, .bg-gradient-to-br p {
      color: black !important;
      font-size: 16pt !important; /* Adjust font size for print */
    }
    .bg-gradient-to-br p {
      font-size: 12pt !important;
    }

    /* Audit Information & Summary boxes */
    .bg-amber-50, .border-amber-200 {
      background-color: white !important;
      border: 1px solid #ccc !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      padding: 15px !important;
    }
    .text-amber-700 {
      color: black !important;
    }

    /* Input fields: make them look like plain text */
    .input-field, .textarea-field {
      border: none !important;
      background: none !important;
      box-shadow: none !important;
      padding: 0 !important;
      height: auto !important;
      resize: none !important;
      overflow: hidden !important;
      font-size: 10pt !important; /* Adjust font size for print */
      line-height: 1.5;
      color: black !important; /* Ensure text is black */
      border-bottom: 1px dashed #999 !important; /* Subtle line for filled fields */
      white-space: pre-wrap; /* Ensure text wraps */
      word-wrap: break-word; /* Ensure long words break */
    }
    /* For input/textarea, hide if empty when printing */
    input:empty:not(:focus), textarea:empty:not(:focus) {
        border-bottom: 1px dashed #ccc !important; /* Lighter dashed line for empty fields */
    }
    /* Hide input elements like type=date, type=time and display their text content */
    input[type="date"],
    input[type="time"] {
        /* This is tricky with pure CSS; a common approach is JS to create span with value */
        /* For this example, we'll just remove border/bg and hope value is visible */
    }


    /* Score display */
    .bg-green-100, .border-green-300 {
      background-color: white !important;
      border: 1px solid #ccc !important;
      color: black !important;
      border-radius: 0 !important;
    }
    #auditScore {
      font-size: 18pt !important;
    }

    /* Checklist Details section title */
    .text-2xl.font-playfair-display {
      font-size: 18pt !important;
      border-bottom: 1px solid #ccc !important;
      margin-bottom: 1rem !important;
    }
    .text-base.text-gray-700.mb-6 {
      font-size: 10pt !important;
      margin-bottom: 1rem !important;
    }


    /* Table styles for print */
    table {
      width: 100% !important;
      border-collapse: collapse !important;
      page-break-inside: auto; /* Allow table to break across pages */
    }
    tr {
      page-break-inside: avoid; /* Avoid breaking rows */
      page-break-after: auto;
    }
    th, td {
      border: 1px solid #ccc !important;
      padding: 8px !important;
      vertical-align: top !important;
      font-size: 9pt !important; /* Smaller font for table content */
      color: black !important;
    }
    thead {
      background-color: #f2f2f2 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    .bg-amber-100 {
      background-color: #f2f2f2 !important;
    }
    .bg-amber-50 {
      background-color: #f9f9f9 !important; /* lighter section header */
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      font-size: 12pt !important;
    }
    .bg-amber-50 .text-lg.mr-2 {
      font-size: 14pt !important;
    }

    /* Checkbox styling for print */
    .checkbox-input-class {
      /* Hide the native checkbox, we'll draw our own */
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 14px; /* Adjust size for print */
      height: 14px;
      border: 1px solid #666; /* Visible box for all */
      border-radius: 2px;
      vertical-align: middle;
      margin-right: 4px;
      position: relative;
      top: -1px;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    .checkbox-input-class:checked {
      background-color: #333; /* Dark background when checked */
      border-color: #333;
    }
    .checkbox-input-class:checked::after {
      content: '✔'; /* Checkmark symbol */
      font-size: 10px; /* Adjust size of checkmark */
      color: white; /* White checkmark */
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    .checkbox-label-class {
        font-size: 9pt !important; /* Smaller font for "ใช่", "ไม่ใช่", "NA" */
        color: black !important;
    }
    .flex.flex-col.sm\\:flex-row {
        flex-direction: row !important; /* Force row layout for checkboxes on print */
        gap: 0.5rem !important; /* Smaller gap */
    }


    /* Signature lines: make dashed line consistent */
    .border-dashed {
      border-color: #ccc !important;
    }
    .pt-4 {
        padding-top: 10px !important;
    }
    .text-sm {
        font-size: 9pt !important;
    }
    .inline-block.w-3\/4 {
        width: 60% !important; /* Adjust width for print */
    }
  }
</style>
</head>
<body class="min-h-screen bg-gray-50 font-inter text-gray-800 flex justify-center py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl w-full bg-white shadow-xl rounded-lg p-8 space-y-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-center pb-6 border-b border-gray-200">
      <div class="font-chonburi text-3xl font-bold text-gray-900 mb-4 sm:mb-0">
        ลงหม้อสุกี้ <span class="block text-sm font-inter font-normal text-gray-600">Food Safety Management</span>
      </div>
      <div class="text-right text-xs text-gray-500">
        <div><span class="font-semibold text-gray-700">เอกสาร:</span> FSHAC-001</div>
        <div><span class="font-semibold text-gray-700">หัวข้อ:</span> Food Safety Audit Checklist</div>
        <div><span class="font-semibold text-gray-700">เวอร์ชัน:</span> v1.0 | <span class="font-semibold text-gray-700">จัดทำเมื่อ:</span> 2025–08–21</div>
      </div>
    </div>

    <!-- Title Band -->
    <div class="bg-gradient-to-br from-gray-900 to-gray-700 text-white p-6 rounded-md border-l-4 border-amber-500">
      <h1 class="text-3xl font-playfair-display font-semibold mb-2">Food Safety Audit Checklist</h1>
      <p class="text-lg font-outfit text-gray-200">รายการตรวจสอบสุขอนามัยและความปลอดภัยอาหาร</p>
    </div>

    <!-- Audit Information & Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-amber-50 p-6 rounded-lg border border-amber-200 shadow-sm">
        <h4 class="flex items-center font-bold text-sm text-amber-700 uppercase mb-4">
          <span class="text-xl mr-2">🔎</span>ข้อมูลการตรวจสอบ (Audit Information)
        </h4>
        <div class="space-y-4">
          <div>
            <label for="auditDate" class="label-class">วันที่ตรวจสอบ:</label>
            <input type="date" id="auditDate" name="date" class="input-field"/>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="startTime" class="label-class">เวลาเริ่มต้น:</label>
              <input type="time" id="startTime" name="startTime" class="input-field"/>
            </div>
            <div>
              <label for="endTime" class="label-class">เวลาสิ้นสุด:</label>
              <input type="time" id="endTime" name="endTime" class="input-field"/>
            </div>
          </div>
          <div>
            <label for="auditor" class="label-class">ผู้ตรวจสอบ:</label>
            <input type="text" id="auditor" name="auditor" class="input-field"/>
          </div>
        </div>
      </div>

      <div class="bg-amber-50 p-6 rounded-lg border border-amber-200 shadow-sm">
        <h4 class="flex items-center font-bold text-sm text-amber-700 uppercase mb-4">
          <span class="text-xl mr-2">📝</span>สรุปผลการตรวจสอบ (Audit Summary)
        </h4>
        <div class="space-y-4">
          <div>
            <label for="area" class="label-class">พื้นที่ที่ตรวจสอบ:</label>
            <input type="text" id="area" name="area" class="input-field"/>
          </div>
          <div>
            <label class="label-class">ระดับความเสี่ยงที่พบ:</label>
            <div class="flex flex-wrap gap-x-4">
              <label class="checkbox-label-class">
                <input type="checkbox" name="riskLevel" value="high" class="checkbox-input-class risk-checkbox"/>
                สูง
              </label>
              <label class="checkbox-label-class">
                <input type="checkbox" name="riskLevel" value="medium" class="checkbox-input-class risk-checkbox"/>
                ปานกลาง
              </label>
              <label class="checkbox-label-class">
                <input type="checkbox" name="riskLevel" value="low" class="checkbox-input-class risk-checkbox"/>
                ต่ำ
              </label>
            </div>
          </div>
          <div>
            <label for="overallSuggestions" class="label-class">ข้อเสนอแนะโดยรวม:</label>
            <textarea id="overallSuggestions" name="overallSuggestions" rows="3" class="textarea-field"></textarea>
          </div>
          <!-- Score Display -->
          <div class="mt-6 p-4 bg-green-100 border border-green-300 rounded-md text-center text-lg font-semibold text-green-800">
            คะแนนความสอดคล้อง: <span id="auditScore" class="text-2xl font-bold">0%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Checklist Details -->
    <section class="mt-8">
      <h2 class="text-2xl font-playfair-display font-semibold text-gray-900 pb-3 mb-6 border-b border-gray-200">
        รายละเอียดรายการตรวจสอบ (Checklist Details)
      </h2>
      <p class="text-base text-gray-700 mb-6">
        ตรวจสอบรายการด้านล่างนี้ และระบุสถานะการปฏิบัติตาม พร้อมบันทึกข้อสังเกตและแผนการแก้ไข
      </p>

      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 border border-gray-200">
          <thead class="bg-amber-100">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/2">
                รายการตรวจสอบ (Checklist Item)
              </th>
              <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/5">
                สถานะ
              </th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-1/4">
                ข้อสังเกต / การดำเนินการแก้ไข (Observations / Corrective Actions)
              </th>
            </tr>
          </thead>
          <tbody id="checklistTableBody" class="bg-white divide-y divide-gray-200">
            <!-- Checklist items will be rendered here by JavaScript -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Signatures -->
    <section class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 text-sm text-gray-800">
      <div>
        <div class="border-t border-dashed border-gray-400 pt-4">
          ผู้ตรวจสอบ: <span class="inline-block w-3/4 border-b border-gray-300"></span><br/>
          ตำแหน่ง: <span class="inline-block w-3/4 border-b border-gray-300"></span><br/>
          วันที่: <span class="inline-block w-3/4 border-b border-gray-300"></span>
        </div>
      </div>
      <div>
        <div class="border-t border-dashed border-gray-400 pt-4">
          ผู้รับรองการแก้ไข: <span class="inline-block w-3/4 border-b border-gray-300"></span><br/>
          ตำแหน่ง: <span class="inline-block w-3/4 border-b border-gray-300"></span><br/>
          วันที่: <span class="inline-block w-3/4 border-b border-gray-300"></span>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Data structure for checklist items
    const checklistItems = [
      // Section 1: Raw Material Receiving & Storage
      { id: '1.1', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'วัตถุดิบทุกชนิดถูกตรวจสอบคุณภาพและปริมาณเมื่อรับเข้าตาม SOP-BOH-001 และ SOP-BOH-009', status: '', observations: '' },
      { id: '1.2', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'วัตถุดิบแช่เย็น/แช่แข็ง มีอุณหภูมิอยู่ในเกณฑ์ที่กำหนดเมื่อรับเข้า (≤4°C สำหรับแช่เย็น, ≤-18°C สำหรับแช่แข็ง)', status: '', observations: '' },
      { id: '1.3', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'วัตถุดิบทุกชิ้นมีการติดฉลากระบุชื่อ, วันที่รับเข้า, และวันหมดอายุอย่างชัดเจน', status: '', observations: '' },
      { id: '1.4', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'วัตถุดิบถูกจัดเก็บในพื้นที่ที่เหมาะสม (เช่น ตู้เย็น, ตู้แช่แข็ง, ห้องเก็บแห้ง) ทันทีหลังรับเข้า', status: '', observations: '' },
      { id: '1.5', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'มีการจัดเก็บวัตถุดิบสูงจากพื้นอย่างน้อย 15 ซม. และห่างจากผนังตาม SOP-BOH-007', status: '', observations: '' },
      { id: '1.6', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'มีการแยกเก็บอาหารดิบและปรุงสุกออกจากกันเพื่อป้องกันการปนเปื้อนข้าม', status: '', observations: '' },
      { id: '1.7', section: '1. การรับและจัดเก็บวัตถุดิบ', icon: '🚚', description: 'มีการหมุนเวียนสต็อกตามหลัก FIFO/FEFO อย่างเคร่งครัด (ตรวจสอบวันหมดอายุ)', status: '', observations: '' },

      // Section 2: Food Preparation & Cooking
      { id: '2.1', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'พื้นที่เตรียมอาหารสะอาด เป็นระเบียบ และปราศจากสิ่งปนเปื้อนก่อนเริ่มงาน', status: '', observations: '' },
      { id: '2.2', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'มีดและเขียงที่มีรหัสสีถูกใช้งานอย่างถูกต้องตามประเภทวัตถุดิบ (เนื้อ, ผัก, อื่นๆ)', status: '', observations: '' },
      { id: '2.3', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'การเตรียมวัตถุดิบ (Mise en Place) ถูกทำอย่างถูกสุขอนามัยและรวดเร็ว', status: '', observations: '' },
      { id: '2.4', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'การปรุงอาหารแต่ละประเภทเป็นไปตามสูตรมาตรฐาน (อ้างอิง SOP-BOH-002)', status: '', observations: '' },
      { id: '2.5', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'อาหารที่ปรุงสุกมีอุณหภูมิภายในที่ปลอดภัยตามมาตรฐาน (เช่น เนื้อสัตว์ปีก ≥74°C)', status: '', observations: '' },
      { id: '2.6', section: '2. การเตรียมและการปรุงอาหาร', icon: '👨‍🍳', description: 'มีการระบายอากาศที่เหมาะสมในบริเวณครัว เพื่อลดความร้อนและควัน', status: '', observations: '' },

      // Section 3: Personal Hygiene
      { id: '3.1', section: '3. สุขอนามัยส่วนบุคคล', icon: '🚶', description: 'พนักงานทุกคนแต่งกายสะอาด สวมชุดยูนิฟอร์มที่สะอาด และสวมหมวก/ตาข่ายคลุมผม', status: '', observations: '' },
      { id: '3.2', section: '3. สุขอนามัยส่วนบุคคล', icon: '🚶', description: 'พนักงานล้างมืออย่างถูกต้องและสม่ำเสมอ (ก่อนเริ่มงาน, หลังเข้าห้องน้ำ, หลังสัมผัสของสกปรก)', status: '', observations: '' },
      { id: '3.3', section: '3. สุขอนามัยส่วนบุคคล', icon: '🚶', description: 'พนักงานสวมถุงมือที่สะอาดและเหมาะสมเมื่อสัมผัสอาหารพร้อมทานหรือวัตถุดิบที่ต้องดูแลเป็นพิเศษ', status: '', observations: '' },
      { id: '3.4', section: '3. สุขอนามัยส่วนบุคคล', icon: '🚶', description: 'พนักงานไม่มีอาการป่วยที่อาจส่งผลต่อความปลอดภัยอาหาร (เช่น ไอ, จาม, ท้องเสีย) ขณะปฏิบัติงาน', status: '', observations: '' },
      { id: '3.5', section: '3. สุขอนามัยส่วนบุคคล', icon: '🚶', description: 'มีการจัดการสุขอนามัยเล็บและเครื่องประดับอย่างถูกต้องตามนโยบาย', status: '', observations: '' },

      // Section 4: Cleaning & Sanitation
      { id: '4.1', section: '4. การทำความสะอาดและสุขาภิบาล', icon: '🧼', description: 'มีตารางการทำความสะอาดประจำวัน/รายสัปดาห์/รายเดือน และพนักงานปฏิบัติตามอย่างเคร่งครัด', status: '', observations: '' },
      { id: '4.2', section: '4. การทำความสะอาดและสุขาภิบาล', icon: '🧼', description: 'อุปกรณ์ครัวและพื้นผิวสัมผัสอาหารทั้งหมดถูกทำความสะอาดและฆ่าเชื้ออย่างถูกต้องตาม SOP-BOH-005', status: '', observations: '' },
      { id: '4.3', section: '4. การทำความสะอาดและสุขาภิบาล', icon: '🧼', description: 'พื้นครัวสะอาด แห้ง และปราศจากสิ่งกีดขวาง (น้ำ, น้ำมัน, เศษอาหาร)', status: '', observations: '' },
      { id: '4.4', section: '4. การทำความสะอาดและสุขาภิบาล', icon: '🧼', description: 'มีการจัดเก็บอุปกรณ์ทำความสะอาดอย่างเป็นระเบียบและถูกสุขอนามัย', status: '', observations: '' },
      { id: '4.5', section: '4. การทำความสะอาดและสุขาภิบาล', icon: '🧼', description: 'ห้องน้ำพนักงานสะอาด ถูกสุขอนามัย และมีอุปกรณ์ล้างมือครบถ้วน', status: '', observations: '' },

      // Section 5: Waste Management
      { id: '5.1', section: '5. การจัดการขยะและของเสีย', icon: '🗑️', description: 'มีถังขยะเพียงพอและแยกประเภทขยะอย่างชัดเจน (เศษอาหาร, รีไซเคิล, ทั่วไป)', status: '', observations: '' },
      { id: '5.2', section: '5. การจัดการขยะและของเสีย', icon: '🗑️', description: 'ถังขยะมีฝาปิดมิดชิด และถูกนำไปทิ้ง/ทำความสะอาดเป็นประจำทุกวันตาม SOP-BOH-004', status: '', observations: '' },
      { id: '5.3', section: '5. การจัดการขยะและของเสีย', icon: '🗑️', description: 'มีการจัดการน้ำมันใช้แล้วอย่างถูกวิธี ไม่มีการทิ้งลงท่อระบายน้ำ', status: '', observations: '' },
      { id: '5.4', section: '5. การจัดการขยะและของเสีย', icon: '🗑️', description: 'พื้นที่จัดเก็บขยะสะอาดและปราศจากสัตว์พาหะ', status: '', observations: '' },

      // Section 6: Temperature Control
      { id: '6.1', section: '6. การควบคุมอุณหภูมิ', icon: '🌡️', description: 'มีการบันทึกอุณหภูมิตู้เย็น/ตู้แช่แข็ง/ไลน์บุฟเฟต์อย่างสม่ำเสมอและอยู่ในเกณฑ์ที่ปลอดภัย', status: '', observations: '' },
      { id: '6.2', section: '6. การควบคุมอุณหภูมิ', icon: '🌡️', description: 'อาหารที่ต้องควบคุมอุณหภูมิถูกจัดเก็บในอุณหภูมิที่ถูกต้องตลอดเวลา (Cold/Hot Holding)', status: '', observations: '' },
      { id: '6.3', section: '6. การควบคุมอุณหภูมิ', icon: '🌡️', description: 'มีการใช้เทอร์โมมิเตอร์ที่สอบเทียบแล้วในการวัดอุณหภูมิอาหารและอุปกรณ์', status: '', observations: '' },

      // Section 7: Cross-Contamination Prevention
      { id: '7.1', section: '7. การป้องกันการปนเปื้อนข้าม', icon: '🧬', description: 'มีการแยกพื้นที่/อุปกรณ์สำหรับวัตถุดิบดิบและอาหารปรุงสุกอย่างชัดเจน', status: '', observations: '' },
      { id: '7.2', section: '7. การป้องกันการปนเปื้อนข้าม', icon: '🧬', description: 'พนักงานเปลี่ยนถุงมือหรือล้างมือเมื่อเปลี่ยนจากการจัดการวัตถุดิบดิบไปอาหารพร้อมทาน', status: '', observations: '' },
      { id: '7.3', section: '7. การป้องกันการปนเปื้อนข้าม', icon: '🧬', description: 'มีการติดป้ายหรือแนวทางสำหรับจัดการสารก่อภูมิแพ้อย่างชัดเจนและปลอดภัย', status: '', observations: '' },
    ];

    // Function to group checklist items by section
    function groupChecklistItems(items) {
      const grouped = {};
      items.forEach(item => {
        if (!grouped[item.section]) {
          grouped[item.section] = [];
        }
        grouped[item.section].push(item);
      });
      return grouped;
    }

    // Function to render checklist table
    function renderChecklist() {
      const tbody = document.getElementById('checklistTableBody');
      tbody.innerHTML = ''; // Clear existing content

      const grouped = groupChecklistItems(checklistItems);
      for (const section in grouped) {
        // Add section header row
        const sectionItems = grouped[section];
        const icon = sectionItems[0].icon; // Get icon from the first item in the section
        const sectionRow = document.createElement('tr');
        sectionRow.className = 'bg-white';
        sectionRow.innerHTML = `
          <td colspan="3" class="p-0 border-none">
            <h3 class="bg-amber-50 py-3 px-4 text-base font-bold text-amber-800 flex items-center border-b border-amber-300">
              <span class="text-lg mr-2">${icon}</span> ${section}
            </h3>
          </td>
        `;
        tbody.appendChild(sectionRow);

        // Add items for this section
        sectionItems.forEach(item => {
          const row = document.createElement('tr');
          row.className = 'bg-white';
          row.innerHTML = `
            <td class="px-4 py-3 align-top text-sm text-gray-900 border-r border-gray-200">
              ${item.id} ${item.description}
            </td>
            <td class="px-4 py-3 align-top text-center border-r border-gray-200">
              <div class="flex flex-col sm:flex-row justify-center items-center gap-2">
                <label class="checkbox-label-class">
                  <input type="checkbox" name="status-${item.id}" value="yes" class="checkbox-input-class status-checkbox" data-item-id="${item.id}" data-status-value="yes" ${item.status === 'yes' ? 'checked' : ''}/>
                  ใช่
                </label>
                <label class="checkbox-label-class">
                  <input type="checkbox" name="status-${item.id}" value="no" class="checkbox-input-class status-checkbox" data-item-id="${item.id}" data-status-value="no" ${item.status === 'no' ? 'checked' : ''}/>
                  ไม่ใช่
                </label>
                <label class="checkbox-label-class">
                  <input type="checkbox" name="status-${item.id}" value="na" class="checkbox-input-class status-checkbox" data-item-id="${item.id}" data-status-value="na" ${item.status === 'na' ? 'checked' : ''}/>
                  NA
                </label>
              </div>
            </td>
            <td class="px-4 py-3 align-top">
              <textarea rows="2" class="textarea-field observation-field" data-item-id="${item.id}">${item.observations}</textarea>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
      addEventListenersToChecklist();
      updateScore(); // Initial score calculation after rendering
    }

    // Function to calculate and update score
    function updateScore() {
      let yesCount = 0;
      let applicableCount = 0;

      checklistItems.forEach(item => {
        if (item.status === 'yes') {
          yesCount++;
          applicableCount++;
        } else if (item.status === 'no') {
          applicableCount++;
        }
        // If status is 'na', it's not counted in applicableCount
      });

      const score = applicableCount > 0 ? ((yesCount / applicableCount) * 100).toFixed(2) : 0;
      document.getElementById('auditScore').textContent = `${score}%`;
    }

    // Event listener for status checkboxes
    function handleStatusChange(event) {
      const target = event.target;
      if (target.classList.contains('status-checkbox')) {
        const itemId = target.dataset.itemId;
        const newStatus = target.dataset.statusValue;

        // Ensure only one checkbox is checked for this item
        document.querySelectorAll(`input[name="status-${itemId}"]`).forEach(checkbox => {
          if (checkbox !== target) {
            checkbox.checked = false;
          }
        });

        // Update the item's status in the data model
        const itemIndex = checklistItems.findIndex(item => item.id === itemId);
        if (itemIndex !== -1) {
          checklistItems[itemIndex].status = target.checked ? newStatus : ''; // If unchecked, clear status
        }
        updateScore();
      }
    }

    // Event listener for observation textareas
    function handleObservationChange(event) {
      const target = event.target;
      if (target.classList.contains('observation-field')) {
        const itemId = target.dataset.itemId;
        const itemIndex = checklistItems.findIndex(item => item.id === itemId);
        if (itemIndex !== -1) {
          checklistItems[itemIndex].observations = target.value;
        }
      }
    }

    // Event listener for risk level checkboxes (radio-like behavior)
    function handleRiskLevelChange(event) {
      const target = event.target;
      if (target.classList.contains('risk-checkbox')) {
        document.querySelectorAll('.risk-checkbox').forEach(checkbox => {
          if (checkbox !== target) {
            checkbox.checked = false;
          }
        });
      }
    }

    // Add event listeners to dynamically rendered elements
    function addEventListenersToChecklist() {
      document.querySelectorAll('.status-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', handleStatusChange);
      });
      document.querySelectorAll('.observation-field').forEach(textarea => {
        textarea.addEventListener('input', handleObservationChange);
      });
    }

    // Set initial date on load
    function setInitialDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      document.getElementById('auditDate').value = `${yyyy}-${mm}-${dd}`;
    }

    // Initialize the form on window load
    window.onload = function() {
      setInitialDate();
      renderChecklist();
      document.querySelectorAll('.risk-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', handleRiskLevelChange);
      });
      // Add event listeners for other input fields to update data model
      document.getElementById('auditor').addEventListener('input', (e) => {}); // Placeholder for data binding
      document.getElementById('area').addEventListener('input', (e) => {}); // Placeholder for data binding
      document.getElementById('overallSuggestions').addEventListener('input', (e) => {}); // Placeholder for data binding
    };
  </script>
</body>
</html>
